= content_for :head, auto_discovery_link_tag(:atom, "http://admin:#{Preference.web_admin_password}@#{admin_links_url(format: :atom).split('://')[1]}")

.row
  %h3
    Links
    - if @player
      by
      = link_to @player.nick, admin_player_path(@player)
    %button.btn.btn-info.badge{type: :button, data: { toggle: :modal, target: '#explain_links'}} ?
  .modal.fade#explain_links{tabindex: -1, role: :dialog, 'aria-labelledby' => 'explain_links_label', 'aria-hidden' => true}
    .modal-dialog
      .modal-content
        .modal-header
          %button.close{type: :button, 'aria-label' => 'Close', data: { dismiss: :modal }}
            %span{'aria-hidden' => true} &times;
          %h4.modal-title#explain_links_label Explanation of Links
        .modal-body
          %p If a player types a url in chat, a link is created to store the title and other meta information so that these links are clickable in chat if the Autolink Server Callback is enabled.  Message of the Day may also include links.  Any link that is rendered with ServerCommand.say_link will be stored in the Links table.  Before the link is shown in chat, the title is requested from the web site and stored in the same record.  The title is cached for an hour or however long the particular web server recommends.

%div{style: 'float: right'}
  = form_tag url_for(action: controller.action_name), method: :get do
    = hidden_field_tag :sort_field, @sort_field
    = hidden_field_tag :sort_order, @sort_order
    = hidden_field_tag :filter, @filter
    = hidden_field_tag :player_id, @player_id
    = text_field_tag :query, @query, placeholder: 'Query Text'
    = submit_tag 'Search', class: 'btn btn-info btn-xs'

%ul.nav.nav-tabs
  %li{class: @filter == 'all' ? 'active' : ''}
    = link_to 'All', admin_links_path(player_id: @player_id), 'aria-controls' => "all"
  %li{class: @filter == 'only_today' ? 'active' : ''}
    = link_to 'Today', admin_links_path(player_id: @player_id, filter: 'only_today'), 'aria-controls' => "non-system"

.tab-contents
  .tab-panel.tab-pane.active
    .row.table-responsive
      %table.table
        %thead
          %tr
            %th=sortable_header_link 'Title', 'lower(title)'
            - unless @player_id
              %th=sortable_header_link 'Linked By', 'link_linked_by'
            %th=sortable_header_link 'Created', 'created_at'
            %th
        %tbody
          - @links.each do |link|
            = render 'link_row', link: link

%p= will_paginate @links